<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime07x - Pro Streaming Fixed</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#d6006e"/>

    <!-- Firebase & HLS.js CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #d6006e; --bg: #0b0c15; --card: #151725; --text: #ffffff; --border: #23263a; }
        
        /* Light Mode Variables */
        body.light-mode { --bg: #f5f6fa; --card: #ffffff; --text: #0b0c15; --border: #dcdde1; }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; }
        body { background-color: var(--bg); color: var(--text); overflow: hidden; -webkit-tap-highlight-color: transparent; transition: background 0.3s, color 0.3s; }

        #page-container { max-width: 480px; margin: 0 auto; height: 100vh; position: relative; display: flex; flex-direction: column; }

        /* --- SPLASH SCREEN CSS --- */
        #splash-screen {
            position: fixed; inset: 0; background: #0b0c15; z-index: 100000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: 0.5s ease;
        }
        #splash-screen img { width: 120px; height: 120px; object-fit: contain; animation: pulseLogo 2s infinite; }
        #splash-screen h2 { margin-top: 15px; font-weight: 800; letter-spacing: 2px; color: #fff; }
        @keyframes pulseLogo { 0% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); opacity: 0.8; } }

        /* --- MAGIC BUTTON BOX STYLE --- */
        @property --angle { syntax: '<angle>'; initial-value: 0deg; inherits: false; }
        
        .magic-box-header {
            margin: 25px 15px 10px 15px;
            padding: 12px;
            text-align: center;
            position: relative;
            background: #0b0c15;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 800;
            color: #fff;
            z-index: 1;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 2px;
            text-transform: uppercase;
            box-shadow: 0 0 20px rgba(114, 0, 255, 0.3);
        }

        .magic-box-header::before {
            content: '';
            position: absolute;
            inset: -4px;
            background: conic-gradient(from var(--angle), transparent, #7200ff, #00ccff, #f000ff, transparent);
            animation: rotate 3s linear infinite;
            z-index: -1;
            border-radius: 50px;
        }

        .magic-box-header::after {
            content: '';
            position: absolute;
            inset: 2px;
            background: #0b0c15;
            border-radius: 50px;
            z-index: -1;
            background-image: radial-gradient(circle at center, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 10px 10px;
        }

        /* --- PREMIUM GENRE ROW (HORIZONTAL SCROLL) --- */
        .premium-genre-row {
            display: flex;
            overflow-x: auto;
            gap: 12px;
            padding: 15px 15px 10px 15px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .premium-genre-row::-webkit-scrollbar { display: none; }

        .premium-box {
            flex: 0 0 auto;
            position: relative;
            height: 38px;
            padding: 0 18px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 13px;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 1px;
            overflow: hidden;
            cursor: pointer;
            z-index: 1;
            background: #151725;
            border: 1px solid rgba(255,255,255,0.05);
            transition: 0.3s;
        }

        .premium-box::before {
            content: '';
            position: absolute;
            inset: -3px;
            background: conic-gradient(from var(--angle), transparent, var(--primary), #00ccff, transparent);
            animation: rotate 4s linear infinite;
            z-index: -1;
        }

        .premium-box::after {
            content: '';
            position: absolute;
            inset: 1.5px;
            background: #151725;
            border-radius: 50px;
            z-index: -1;
        }

        .premium-box i {
            margin-right: 6px;
            font-size: 14px;
            color: var(--primary);
        }

        .premium-box:active {
            transform: scale(0.92);
        }

        /* --- SELECTIVE ANIMATION LOGIC --- */
        @keyframes rotate { to { --angle: 360deg; } }
        @keyframes pulse { 0% { opacity: 0.7; } 50% { opacity: 1; filter: brightness(1.3); } 100% { opacity: 0.7; } }
        @keyframes rgbShift { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(360deg); } }

        /* Rounded Border Fix */
        .anim-active .search-box, 
        .anim-active #appearance-btn, 
        .anim-active #anim-mode-btn, 
        .anim-active #adult-mode-btn,
        .anim-active #contact-btn,
        .anim-active .custom-toggle-btn,
        .anim-active .content-card,
        .anim-active .detail-poster-img { 
            border: 2px solid transparent !important; 
        }

        /* Style 1: Updated for Round Shape Rotation */
        body.anim-1 .search-box, 
        body.anim-1 #appearance-btn, 
        body.anim-1 #anim-mode-btn, 
        body.anim-1 #adult-mode-btn,
        body.anim-1 #contact-btn,
        body.anim-1 .custom-toggle-btn,
        body.anim-1 .content-card, 
        body.anim-1 .detail-poster-img {
            background: linear-gradient(var(--card), var(--card)) padding-box, 
                        linear-gradient(var(--angle), #00ccff, #fdfd1e, #f000ff, #7200ff, #00ccff) border-box !important;
            animation: rotate 3s linear infinite;
        }
        /* Specific Fix for Search Box Background */
        body.anim-1 .search-section .search-box {
            background: linear-gradient(var(--bg), var(--bg)) padding-box, 
                        linear-gradient(var(--angle), #00ccff, #fdfd1e, #f000ff, #7200ff, #00ccff) border-box !important;
        }

        /* Style 2: Pulsing Glow */
        body.anim-2 .search-box, 
        body.anim-2 #appearance-btn, 
        body.anim-2 #anim-mode-btn, 
        body.anim-2 #adult-mode-btn,
        body.anim-2 #contact-btn,
        body.anim-2 .custom-toggle-btn,
        body.anim-2 .content-card, 
        body.anim-2 .detail-poster-img {
            border-color: var(--primary) !important;
            animation: pulse 2s ease-in-out infinite !important;
            box-shadow: 0 0 10px rgba(214, 0, 110, 0.4);
        }

        /* Style 3: RGB Wave */
        body.anim-3 .search-box, 
        body.anim-3 #appearance-btn, 
        body.anim-3 #anim-mode-btn, 
        body.anim-3 #adult-mode-btn,
        body.anim-3 #contact-btn,
        body.anim-3 .custom-toggle-btn,
        body.anim-3 .content-card,
        body.anim-3 .detail-poster-img {
            border-color: #00d2ff !important;
            animation: rgbShift 4s linear infinite !important;
        }

        /* --- PROFESSIONAL PAGE TRANSITION --- */
        .page { flex: 1; overflow-y: auto; display: none; padding-bottom: 90px; animation: fadeIn 0.4s ease-out; scrollbar-width: none; }
        .page::-webkit-scrollbar { display: none; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .logo-section { background: var(--bg); padding: 15px 0 5px 0; display: flex; justify-content: center; width: 100%; }
        .logo-section img { height: 45px; width: auto; object-fit: contain; }

        .search-section { background: var(--bg); padding: 10px 15px; display: flex; justify-content: center; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--border); backdrop-filter: blur(12px); transition: 0.3s; }
        .search-box { background: rgba(255,255,255,0.05); padding: 10px 15px; border-radius: 25px; border: 1px solid var(--border); width: 100%; display: flex; align-items: center; }
        body.light-mode .search-box { background: rgba(0,0,0,0.05); }
        .search-box input { background: none; border: none; color: var(--text); outline: none; font-size: 14px; width: 100%; text-align: center; }

        .slider-container { width: 100%; height: 230px; overflow: hidden; position: relative; border-radius: 0 0 20px 20px; background: #000; }
        .slider { display: flex; transition: 0.6s cubic-bezier(0.4, 0, 0.2, 1); height: 100%; width: 100%; }
        .slide { min-width: 100%; height: 100%; position: relative; cursor: pointer; }
        .slide img { width: 100%; height: 100%; object-fit: cover; }
        
        .category-header { display: flex; justify-content: space-between; align-items: center; padding-right: 15px; margin-top: 20px; }
        .category-title { font-size: 18px; font-weight: 700; padding-left: 15px; border-left: 4px solid var(--primary); }
        .view-all { color: var(--primary); font-size: 11px; font-weight: 800; text-transform: uppercase; cursor: pointer; }

        .content-slider { display: flex; overflow-x: auto; padding: 10px 15px; gap: 12px; scrollbar-width: none; }
        .content-slider::-webkit-scrollbar { display: none; }
        
        .content-card { flex: 0 0 120px; border-radius: 12px; overflow: hidden; background: var(--card); aspect-ratio: 2/3; position: relative; cursor: pointer; border: 1px solid var(--border); transition: 0.3s; }
        .content-card:active { transform: scale(0.95); }
        .content-card img { width: 100%; height: 100%; object-fit: cover; }
        .card-title { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.7); padding: 5px; font-size: 10px; text-align: center; color: #fff; }

        /* --- NEW BADGE CSS --- */
        .new-badge {
            position: absolute; top: 8px; left: 8px; background: var(--primary);
            color: #fff; font-size: 9px; font-weight: 800; padding: 3px 8px;
            border-radius: 6px; z-index: 5; box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            text-transform: uppercase;
        }

        /* --- GENRE CHIPS CSS --- */
        .genre-container { display: flex; overflow-x: auto; padding: 5px 15px; gap: 10px; scrollbar-width: none; margin-bottom: 5px; margin-top: 5px; }
        .genre-container::-webkit-scrollbar { display: none; }
        .genre-chip { padding: 8px 18px; background: var(--card); border: 1px solid var(--border); border-radius: 20px; font-size: 12px; white-space: nowrap; cursor: pointer; transition: 0.2s; font-weight: 600; color: #aaa; }
        .genre-chip.active { background: var(--primary); color: #fff; border-color: var(--primary); box-shadow: 0 4px 10px rgba(214, 0, 110, 0.3); }

        #player-overlay { position: fixed; inset: 0; background: #000; z-index: 9999; display: none; }
        .video-wrapper { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #000; overflow: hidden; }
        video { width: 100%; height: 100%; object-fit: contain; }
        
        .player-ui { position: absolute; inset: 0; background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, transparent 50%, rgba(0,0,0,0.8) 100%); display: flex; flex-direction: column; justify-content: space-between; padding: 25px; z-index: 10; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); opacity: 1; }
        .player-ui.hidden { opacity: 0; pointer-events: none; }

        .p-btn { background: none; border: none; color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; }
        .p-btn i { font-size: 22px; }
        .p-btn:active { transform: scale(0.8); color: var(--primary); text-shadow: 0 0 15px var(--primary); }

        .p-top { display: flex; align-items: center; gap: 15px; }
        #video-title { font-weight: 700; font-size: 16px; color: #fff; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .p-bottom-area { width: 100%; display: flex; flex-direction: column; gap: 15px; }

        .p-progress-box { width: 100%; height: 30px; display: flex; align-items: center; cursor: pointer; position: relative; gap: 10px; }
        .p-bar-bg { flex: 1; height: 4px; background: rgba(255,255,255,0.2); border-radius: 10px; position: relative; transition: height 0.2s; }
        .p-progress-box:hover .p-bar-bg { height: 6px; }
        #p-fill { height: 100%; background: var(--primary); width: 0%; border-radius: 10px; position: relative; transition: width 0.1s linear; box-shadow: 0 0 10px var(--primary); }
        #p-fill::after { content: ''; position: absolute; right: -7px; top: 50%; transform: translateY(-50%) scale(0); width: 14px; height: 14px; background: #fff; border-radius: 50%; border: 2px solid var(--primary); box-shadow: 0 0 8px var(--primary); transition: 0.2s; }
        .p-progress-box:hover #p-fill::after { transform: translateY(-50%) scale(1); }
        .seekbar-time { font-family: monospace; font-size: 12px; font-weight: bold; color: #fff; min-width: 40px; }

        #p-ep-drawer {
            position: absolute; right: -280px; top: 0; bottom: 0; width: 250px;
            background: rgba(11, 12, 21, 0.98); border-left: 1px solid var(--border);
            z-index: 101; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; flex-direction: column; padding: 20px 0;
        }
        #p-ep-drawer.open { right: 0; }
        .drawer-header { padding: 0 20px 15px; border-bottom: 1px solid var(--border); font-weight: bold; color: var(--primary); display: flex; justify-content: space-between; align-items: center; font-size: 16px; }
        .drawer-list { flex: 1; overflow-y: auto; padding: 15px; scrollbar-width: none; }
        .drawer-item { 
            background: var(--card); padding: 12px; border-radius: 10px; margin-bottom: 10px; 
            display: flex; align-items: center; gap: 12px; cursor: pointer; border: 1px solid transparent;
            font-size: 13px; color: var(--text); transition: 0.2s;
        }
        .drawer-item:active { transform: scale(0.95); }
        .drawer-item i { color: var(--primary); font-size: 14px; }

        .p-controls-bar { display: flex; justify-content: space-between; align-items: center; }
        .p-left, .p-right { display: flex; align-items: center; gap: 15px; }

        .p-vol-box { display: flex; align-items: center; gap: 8px; }
        #vol-slider { width: 60px; height: 4px; accent-color: var(--primary); cursor: pointer; display: none; transition: 0.3s; }
        .p-vol-box:hover #vol-slider { display: block; }

        .hide-in-portrait { display: none !important; }
        .video-wrapper:fullscreen .hide-in-portrait,
        .video-wrapper:-webkit-full-screen .hide-in-portrait { display: flex !important; }
        
        #p-speed-menu {
            position: absolute; right: 0; top: 0; bottom: 0; width: 120px;
            background: rgba(0,0,0,0.7); display: none; flex-direction: column;
            justify-content: center; align-items: center; gap: 25px; z-index: 100;
        }
        .speed-item { color: #fff; font-size: 15px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .speed-item.active { color: #2ecc71; }

        #speed-overlay { position: absolute; top: 15%; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.6); color: #fff; padding: 5px 15px; border-radius: 20px; font-size: 14px; font-weight: bold; display: none; z-index: 100; pointer-events: none; border: 1px solid var(--primary); }

        .p-menu { 
            position: absolute; bottom: 100px; right: 25px; background: #0f101a; 
            border-radius: 15px; display: none; flex-direction: column; min-width: 170px; 
            max-height: 250px; overflow-y: auto; z-index: 100; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.8); animation: slideUp 0.3s ease; 
        }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .p-menu-header { background: var(--primary); color: #fff; padding: 12px; text-align: center; font-weight: 700; font-size: 14px; position: sticky; top: 0; z-index: 1; }
        .p-menu-item { padding: 14px 20px; font-size: 14px; border-bottom: 1px solid var(--border); cursor: pointer; color: #fff; transition: 0.2s; }
        .p-menu-item:hover { background: rgba(255,255,255,0.05); }
        .p-menu-item.active { color: var(--primary); font-weight: bold; background: rgba(214, 0, 110, 0.1); }

        /* Custom Alert Modals */
        #appearance-modal, #confirm-modal, #resume-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 20000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .theme-container, .confirm-box { background: var(--card); width: 90%; max-width: 320px; border-radius: 24px; padding: 25px; border: 1px solid var(--border); text-align: center; box-shadow: 0 15px 40px rgba(0,0,0,0.5); }
        
        .confirm-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; color: var(--text); }
        .confirm-msg { font-size: 14px; color: #aaa; margin-bottom: 25px; }
        .confirm-btns { display: flex; gap: 10px; }
        .confirm-btns button { flex: 1; padding: 12px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-cancel { background: #23263a; color: #fff; }
        .btn-confirm { background: var(--primary); color: #fff; }

        /* --- PROFESSIONAL TOAST NOTIFICATION --- */
        #toast-box { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: #fff; padding: 10px 25px; border-radius: 30px; font-size: 13px; font-weight: bold; z-index: 50000; display: none; border: 1px solid var(--primary); backdrop-filter: blur(5px); box-shadow: 0 5px 15px rgba(0,0,0,0.5); }

        .theme-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-height: 300px; overflow-y: auto; padding: 5px; scrollbar-width: none; }
        .theme-grid::-webkit-scrollbar { display: none; }
        .theme-card { background: #1a1c29; border-radius: 12px; padding: 12px; text-align: center; cursor: pointer; border: 2px solid transparent; font-size: 13px; font-weight: bold; transition: 0.2s; color: #fff; }
        .theme-card.active { border-color: var(--primary); background: rgba(255,255,255,0.05); }
        
        .bottom-nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 480px; background: #0f101a; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid var(--border); z-index: 1000; border-radius: 20px 20px 0 0; }
        body.light-mode .bottom-nav { background: #ffffff; }
        .nav-item { color: #5c5e70; text-align: center; font-size: 10px; flex: 1; cursor: pointer; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 4px; }
        
        .grid-view { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px; }
        .ep-list-item { background: var(--card); padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border); }

        .detail-backdrop { width: 100%; height: 350px; position: relative; }
        .detail-backdrop img { width: 100%; height: 100%; object-fit: cover; filter: brightness(0.6); }
        .backdrop-overlay { position: absolute; inset: 0; background: linear-gradient(0deg, var(--bg) 10%, transparent 100%); }
        .detail-content { position: relative; margin-top: -150px; padding: 0 20px; }
        .detail-main { display: flex; gap: 20px; align-items: flex-end; }
        .detail-poster-img { width: 120px; aspect-ratio: 2/3; border-radius: 15px; object-fit: cover; border: 2px solid var(--border); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .detail-info { flex: 1; padding-bottom: 10px; }
        .detail-info h2 { font-size: 24px; font-weight: 800; margin-bottom: 10px; }
        .meta-badges { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px; }
        .badge { background: rgba(255,255,255,0.1); padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: bold; color: #ccc; display: flex; align-items: center; gap: 4px; }
        body.light-mode .badge { background: rgba(0,0,0,0.05); color: #666; }
        .badge i { color: #ffc107; font-size: 10px; }
        .detail-actions { display: flex; gap: 12px; margin-top: 20px; }
        .btn-episodes { background: #7c4dff; color: #fff; flex: 1; padding: 14px; border-radius: 12px; border: none; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 10px; text-transform: uppercase; cursor: pointer; }
        .btn-plus { background: #23263a; color: #fff; width: 55px; height: 55px; border-radius: 12px; border: none; font-size: 20px; cursor: pointer; }
        .btn-share { background: rgba(255,255,255,0.1); color: #fff; width: 55px; height: 55px; border-radius: 12px; border: none; font-size: 20px; cursor: pointer; }
        .desc-box { background: rgba(255,255,255,0.03); border-radius: 15px; padding: 15px; margin-top: 25px; border-left: 4px solid #7c4dff; font-size: 14px; line-height: 1.6; color: #bbb; }
        .section-header { display: flex; align-items: center; gap: 10px; margin-top: 30px; margin-bottom: 15px; }
        .section-bar { width: 4px; height: 20px; background: #7c4dff; border-radius: 2px; }
        .section-header h3 { font-size: 18px; font-weight: 700; }
        .profile-section { margin-top: 30px; text-align: left; padding: 0 20px; }
        .section-label { font-size: 16px; font-weight: bold; margin-bottom: 10px; display: block; color: var(--primary); }

        .custom-toggle-btn {
            margin-top: 12px; background: var(--card); padding: 12px 20px; width: 100%;
            border-radius: 12px; border: 1px solid var(--border); display: flex;
            justify-content: space-between; align-items: center; cursor: pointer; transition: 0.3s;
        }
        .toggle-label { font-size: 14px; font-weight: 700; }
        .switch-box { display: flex; align-items: center; gap: 12px; }
        .custom-switch { width: 54px; height: 28px; background: #2f3542; border-radius: 20px; position: relative; border: 1px solid var(--border); transition: 0.4s; }
        .switch-thumb { width: 20px; height: 20px; background: #fff; border-radius: 50%; position: absolute; top: 3px; left: 4px; transition: 0.4s; }
        .switch-icons { display: flex; align-items: center; gap: 8px; font-size: 16px; }
        
        body.light-mode .custom-switch { background: var(--primary); }
        body.light-mode .switch-thumb { left: 28px; }
        body.light-mode .fa-moon { color: #ced6e0; }
        body.light-mode .fa-sun { color: #ffa502; text-shadow: 0 0 10px #ffa502; }
        body:not(.light-mode) .fa-moon { color: #fff; text-shadow: 0 0 10px #fff; }
        body:not(.light-mode) .fa-sun { color: #57606f; }

        /* GESTURE SLIDERS */
        #brightness-overlay { position: fixed; inset: 0; background: #000; opacity: 0; pointer-events: none; z-index: 9998; }
        .gesture-slider-wrap {
            position: absolute; top: 50%; transform: translateY(-50%); width: 45px; height: 160px;
            background: rgba(0,0,0,0.6); border-radius: 30px; display: none; flex-direction: column;
            align-items: center; justify-content: space-between; padding: 10px 0; z-index: 10001;
            border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px);
        }
        #g-bright-wrap { left: 20px; }
        #g-vol-wrap { right: 20px; }
        .g-icon { color: #fff; font-size: 16px; margin-bottom: 5px; }
        .g-track { flex: 1; width: 4px; background: rgba(255,255,255,0.2); border-radius: 5px; position: relative; overflow: hidden; }
        .g-fill { position: absolute; bottom: 0; left: 0; width: 100%; background: var(--primary); transition: height 0.05s linear; }
        .g-percent { color: #fff; font-size: 10px; font-weight: bold; margin-top: 5px; font-family: monospace; }

    </style>
</head>
<body>

<!-- SPLASH SCREEN -->
<div id="splash-screen">
    <img src="https://i.postimg.cc/5y68WQZY/20251028-171846.png" alt="Splash Logo">
    <h2>ANIME07X</h2>
</div>

<div id="brightness-overlay"></div>
<div id="toast-box">Notification</div>

<div id="page-container">
    <div class="logo-section"><img src="https://i.postimg.cc/LXRFptGp/20251028-172955.png" alt="Anime07x Logo"></div>
    <div class="search-section"><div class="search-box"><input type="text" id="search-input" placeholder="Search Anime..." oninput="handleSearch(this.value)"></div></div>

    <div id="home-page" class="page active">
        <div class="slider-container"><div class="slider" id="main-slider"></div></div>
        
        <!-- PREMIUM GENRE ROW -->
        <div class="premium-genre-row">
            <div class="premium-box" onclick="goToGenreMovies('Action')"><i class="fas fa-hand-fist"></i> Action</div>
            <div class="premium-box" onclick="goToGenreMovies('Adventure')"><i class="fas fa-compass"></i> Adventure</div>
            <div class="premium-box" onclick="goToGenreMovies('Comedy')"><i class="fas fa-face-laugh-squint"></i> Comedy</div>
            <div class="premium-box" onclick="goToGenreMovies('Horror')"><i class="fas fa-ghost"></i> Horror</div>
            <div class="premium-box" onclick="goToGenreMovies('Romance')"><i class="fas fa-heart"></i> Romance</div>
            <div class="premium-box" onclick="goToGenreMovies('Thriller')"><i class="fas fa-bolt"></i> Thriller</div>
            <div class="premium-box" onclick="goToGenreMovies('Drama')"><i class="fas fa-masks-theater"></i> Drama</div>
            <div class="premium-box" onclick="goToGenreMovies('Sci-Fi')"><i class="fas fa-rocket"></i> Sci-Fi</div>
        </div>

        <div class="category-section"><div class="category-header"><h2 class="category-title">Hollywood</h2><span class="view-all" onclick="tab('movies-page')">VIEW ALL</span></div><div class="content-slider" id="hollywood-home"></div></div>
        <div class="category-section"><div class="category-header"><h2 class="category-title">Bollywood</h2><span class="view-all" onclick="tab('movies-page')">VIEW ALL</span></div><div class="content-slider" id="bollywood-home"></div></div>
        <div class="category-section"><div class="category-header"><h2 class="category-title">Web Series</h2><span class="view-all" onclick="tab('series-page')">VIEW ALL</span></div><div class="content-slider" id="web-series-home"></div></div>
        <div class="category-section"><div class="category-header"><h2 class="category-title">South Indian</h2><span class="view-all" onclick="tab('movies-page')">VIEW ALL</span></div><div class="content-slider" id="south-indian-home"></div></div>
        <div class="category-section"><div class="category-header"><h2 class="category-title">Korean</h2><span class="view-all" onclick="tab('series-page')">VIEW ALL</span></div><div class="content-slider" id="korean-home"></div></div>
        <div class="category-section"><div class="category-header"><h2 class="category-title">Cartoon</h2><span class="view-all" onclick="tab('movies-page')">VIEW ALL</span></div><div class="content-slider" id="cartoon-home"></div></div>
        <div class="category-section" id="adult-section"><div class="category-header"><h2 class="category-title">18+ Content</h2><span class="view-all" onclick="tab('movies-page')">VIEW ALL</span></div><div class="content-slider" id="18-plus-home"></div></div>
    </div>

    <div id="movies-page" class="page">
        <div class="category-title" style="padding:15px 15px 5px 15px">All Movies</div>
        <div class="genre-container" id="movie-genres"></div>
        <div id="movie-dynamic-sections">
            <!-- Movie Sliders Load Here -->
        </div>
        <div class="grid-view" id="grid-movies" style="display:none;"></div>
    </div>
    
    <div id="anime-page" class="page">
        <!-- MAGIC BOX DESIGN -->
        <div class="magic-box-header">Anime World</div>
        <div class="category-section"><div class="category-header"><h2 class="category-title">Anime Movies</h2></div><div class="content-slider" id="anime-movies-list"></div></div>
        <div class="category-section" style="margin-bottom: 30px;"><div class="category-header"><h2 class="category-title">Anime Web Series</h2></div><div class="content-slider" id="anime-series-list"></div></div>
        
        <div class="magic-box-header">Cartoon World</div>
        <div class="category-section"><div class="category-header"><h2 class="category-title">Cartoon Movies</h2></div><div class="content-slider" id="cartoon-movies-list"></div></div>
        <div class="category-section"><div class="category-header"><h2 class="category-title">Cartoon Web Series</h2></div><div class="content-slider" id="cartoon-series-list"></div></div>
    </div>

    <div id="series-page" class="page">
        <div class="category-title" style="padding:15px 15px 5px 15px">Series Universe</div>
        <!-- GENRE CHIPS FOR SERIES -->
        <div class="genre-container" id="series-genres"></div>
        
        <div id="series-dynamic-sections">
            <!-- Dynamic Category Sliders Load Here -->
        </div>
        <div class="grid-view" id="grid-series-filtered" style="display:none;"></div>
    </div>

    <div id="live-page" class="page"><div class="category-title" style="padding:15px">Live TV</div><div class="grid-view" id="grid-live"></div></div>
    
    <div id="account-page" class="page">
        <div style="padding: 30px 0; text-align: center;">
            <img src="https://i.postimg.cc/5y68WQZY/20251028-171846.png" style="width:100px; height:100px; object-fit:contain; margin-bottom:10px;">
            <h2 style="font-weight: 800; font-size: 28px; letter-spacing: 1px;">ANIME07x</h2>
            
            <div style="padding: 0 20px;">
                <button id="appearance-btn" style="margin-top:20px; background:var(--card); color:var(--text); border:1px solid var(--border); padding:15px; width:100%; border-radius:12px;" onclick="openThemeModal()">Appearance</button>
                <button id="anim-mode-btn" style="margin-top:12px; background:var(--card); color:var(--text); border:1px solid var(--border); padding:15px; width:100%; border-radius:12px; display:flex; justify-content:space-between; align-items:center;" onclick="cycleAnimBorder()">
                    <span>Animation Border</span>
                    <span id="anim-status" style="color:var(--primary); font-weight:bold;">OFF</span>
                </button>
                <button id="adult-mode-btn" style="margin-top:12px; background:var(--card); color:var(--text); border:1px solid var(--border); padding:15px; width:100%; border-radius:12px; display:flex; justify-content:space-between; align-items:center;" onclick="toggleAdultMode()">
                    <span>18+ Content</span>
                    <span id="adult-status" style="color:var(--primary); font-weight:bold;">OFF</span>
                </button>

                <a href="https://t.me/anime07xx" target="_blank" style="text-decoration:none;">
                    <button id="contact-btn" style="margin-top:12px; background:var(--card); color:var(--text); border:1px solid var(--border); padding:15px; width:100%; border-radius:12px; display:flex; justify-content:space-between; align-items:center; cursor:pointer;">
                        <span>Contact</span>
                        <i class="fab fa-telegram" style="color:#229ED9; font-size:20px;"></i>
                    </button>
                </a>

                <div class="custom-toggle-btn" onclick="toggleThemeMode()">
                    <span class="toggle-label">Theme Mode</span>
                    <div class="switch-box">
                        <div class="switch-icons">
                            <i class="fas fa-moon"></i>
                            <div class="custom-switch"><div class="switch-thumb"></div></div>
                            <i class="fas fa-sun"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="profile-section"><span class="section-label">My Watchlist</span><div class="content-slider" id="saved-list"></div></div>
            <div class="profile-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span class="section-label" style="margin-bottom: 0;">Recent History</span>
                    <span onclick="clearHistory()" style="font-size: 11px; color: var(--primary); font-weight: bold; cursor: pointer;">CLEAR ALL</span>
                </div>
                <div class="content-slider" id="history-list"></div>
            </div>
        </div>
    </div>
    <div id="detail-page" class="page"></div>

    <!-- PLAYER OVERLAY -->
    <div id="player-overlay">
        <div class="video-wrapper" id="v-wrapper" onclick="togglePlayerUI()" 
             onmousedown="playerPointerDown(event)" onmouseup="playerPointerUp(event)"
             ontouchstart="playerPointerDown(event)" ontouchend="playerPointerUp(event)"
             onmousemove="playerPointerMove(event)" ontouchmove="playerPointerMove(event)">
            
            <video id="main-video" playsinline></video>

            <div id="g-bright-wrap" class="gesture-slider-wrap">
                <i class="fas fa-sun g-icon"></i>
                <div class="g-track"><div id="g-bright-fill" class="g-fill"></div></div>
                <span id="g-bright-text" class="g-percent">0%</span>
            </div>

            <div id="g-vol-wrap" class="gesture-slider-wrap">
                <i class="fas fa-volume-up g-icon"></i>
                <div class="g-track"><div id="g-vol-fill" class="g-fill"></div></div>
                <span id="g-vol-text" class="g-percent">0%</span>
            </div>

            <div id="speed-overlay">2X Speed >></div>

            <div id="p-ep-drawer" onclick="event.stopPropagation()">
                <div class="drawer-header"><span>EPISODES</span><i class="fas fa-times" onclick="toggleEpDrawer()"></i></div>
                <div class="drawer-list" id="drawer-ep-list"></div>
            </div>

            <div id="p-speed-menu" onclick="event.stopPropagation()">
                <div class="speed-item" onclick="changeSpeed(0.5)">0.5x</div>
                <div class="speed-item" onclick="changeSpeed(0.75)">0.75x</div>
                <div class="speed-item active" onclick="changeSpeed(1)">1x</div>
                <div class="speed-item" onclick="changeSpeed(1.25)">1.25x</div>
                <div class="speed-item" onclick="changeSpeed(1.5)">1.5x</div>
                <div class="speed-item" onclick="changeSpeed(2)">2x</div>
            </div>
            
            <div class="player-ui" id="player-ui">
                <div class="p-top" onclick="event.stopPropagation()">
                    <button class="p-btn" onclick="closePlayer()"><i class="fas fa-chevron-left"></i></button>
                    <span id="video-title">Loading...</span>
                </div>
                <div class="p-mid"></div>
                <div class="p-bottom-area" onclick="event.stopPropagation()">
                    <div class="p-progress-box" onmousedown="startDrag(event)" ontouchstart="startDrag(event)">
                        <span class="seekbar-time" id="p-current">00:00</span>
                        <div class="p-bar-bg"><div id="p-fill"></div></div>
                        <span class="seekbar-time" id="p-duration">00:00</span>
                    </div>

                    <div class="p-controls-bar">
                        <div class="p-left">
                            <button class="p-btn" onclick="togglePlay()"><i class="fas fa-play" id="small-play-btn"></i></button>
                            <div class="p-vol-box">
                                <button class="p-btn" onclick="muteToggle()"><i class="fas fa-volume-high" id="vol-icon"></i></button>
                                <input type="range" id="vol-slider" min="0" max="1" step="0.1" value="1" oninput="setVolume(this.value)">
                            </div>
                        </div>
                        <div class="p-right">
                            <button class="p-btn" id="drawer-arrow-btn" style="display:none;" onclick="toggleEpDrawer(event)"><i class="fas fa-chevron-left"></i></button>
                            <button class="p-btn hide-in-portrait" onclick="toggleSpeedMenu(event)"><i class="fas fa-gauge-high"></i><span id="speed-label" style="font-size: 11px; font-weight: bold; margin-left:5px;">1x</span></button>
                            <button class="p-btn hide-in-portrait" onclick="toggleMenu(event, 'p-quality-menu')"><i class="fas fa-sliders-h"></i><span id="quality-label" style="font-size: 11px; font-weight: bold; margin-left:5px;">Auto</span></button>
                            <button class="p-btn hide-in-portrait" onclick="toggleMenu(event, 'p-audio-menu')"><i class="fas fa-language"></i></button>
                            <button class="p-btn hide-in-portrait" onclick="toggleMenu(event, 'p-subtitle-menu')"><i class="fas fa-closed-captioning"></i></button>
                            <button class="p-btn hide-in-portrait" onclick="cycleFit()"><i class="fas fa-expand-alt"></i></button>
                            <button class="p-btn" onclick="handleFullscreen()"><i class="fas fa-expand"></i></button>
                        </div>
                    </div>
                </div>
                <div class="p-menu" id="p-quality-menu"></div>
                <div class="p-menu" id="p-audio-menu"></div>
                <div class="p-menu" id="p-subtitle-menu"></div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="confirm-modal">
        <div class="confirm-box">
            <div class="confirm-title">Clear History?</div>
            <div class="confirm-msg">This will remove all your recently watched items.</div>
            <div class="confirm-btns">
                <button class="btn-cancel" onclick="closeConfirmModal()">Cancel</button>
                <button class="btn-confirm" onclick="executeClearHistory()">Clear All</button>
            </div>
        </div>
    </div>

    <div id="resume-modal">
        <div class="confirm-box">
            <div class="confirm-title"><i class="fas fa-history" style="color:var(--primary); margin-right:8px;"></i> Resume Playback?</div>
            <div class="confirm-msg" id="resume-msg">Continue from where you left off?</div>
            <div class="confirm-btns">
                <button class="btn-cancel" onclick="restartVideo()">START OVER</button>
                <button class="btn-confirm" onclick="resumeVideo()">RESUME</button>
            </div>
        </div>
    </div>

    <div id="appearance-modal">
        <div class="theme-container">
            <h3 style="color:var(--text); margin-bottom:15px; font-size:16px;">Choose Theme</h3>
            <div class="theme-grid" id="theme-grid-list">
                <div class="theme-card" onclick="setTheme('#d6006e')">Anime Pink</div>
                <div class="theme-card" onclick="setTheme('#7c4dff')">Classic Violet</div>
                <div class="theme-card" onclick="setTheme('#0088ff')">Ocean Blue</div>
                <div class="theme-card" onclick="setTheme('#00c853')">Forest Green</div>
                <div class="theme-card" onclick="setTheme('#ff3d00')">Lava Red</div>
                <div class="theme-card" onclick="setTheme('#ffab00')">Midnight Gold</div>
                <div class="theme-card" onclick="setTheme('#9c27b0')">Deep Purple</div>
            </div>
            <button style="width:100%; padding:12px; margin-top:20px; background:var(--primary); border:none; color:#fff; border-radius:12px; font-weight:bold;" onclick="closeThemeModal()">Apply Theme</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="tab('home-page')"><i class="fas fa-bolt"></i>Home</div>
        <div class="nav-item" onclick="tab('movies-page')"><i class="fas fa-film"></i>Movies</div>
        <div class="nav-item" onclick="tab('anime-page')"><i class="fas fa-mask"></i>Anime</div>
        <div class="nav-item" onclick="tab('series-page')"><i class="fas fa-layer-group"></i>Series</div>
        <div class="nav-item" onclick="tab('live-page')"><i class="fas fa-desktop"></i>Live</div>
        <div class="nav-item" onclick="tab('account-page')"><i class="fas fa-user-circle"></i>Profile</div>
    </nav>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAwc9eWzT9OYOCe8hab2ouivQsyEgu2doE", authDomain: "anime07x-c77ba.firebaseapp.com", databaseURL: "https://anime07x-c77ba-default-rtdb.firebaseio.com", projectId: "anime07x-c77ba", storageBucket: "anime07x-c77ba.firebasestorage.app", messagingSenderId: "869262301806", appId: "1:869262301806:web:887cfd924ac0b8b451e47f" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let allData = [], hls = null, uiTimer, dragging = false, speedTimer, currentManualSpeed = 1;
    let currentItem = null, pendingResumeTime = 0; 
    const video = document.getElementById('main-video');
    const playerUI = document.getElementById('player-ui');
    const bottomNav = document.querySelector('.bottom-nav');

    // GESTURE & FILTERS
    let isGestureActive = false, gestureStartY = 0, gestureSide = "", initialVol = 1, initialBright = 100, currentBrightness = 100, gestureHideTimer;
    
    const movieGenres = ["All", "Hollywood", "Bollywood", "South Indian", "Korean", "Anime", "Cartoon"];
    const seriesGenres = ["All", "Anime", "Drama", "Romance", "Action", "Thriller", "Horror", "Sci-Fi", "Fantasy", "Comedy", "Documentary", "K-Drama", "C-Drama", "J-Drama"];
    
    let selectedMovieGenre = "All", selectedSeriesGenre = "All";
    let currentAnimMode = parseInt(localStorage.getItem('animMode')) || 0;
    const animNames = ["OFF", "Style 1", "Style 2", "Style 3"];
    let hideAdult = localStorage.getItem('hideAdult') === 'true';
    let currentSlideIndex = 0, autoSlideInterval;

    function init() {
        setTimeout(() => {
            const splash = document.getElementById('splash-screen');
            splash.style.opacity = '0';
            setTimeout(() => splash.style.display = 'none', 500);
        }, 2500);

        applyAnimMode(currentAnimMode); applyAdultMode();
        const savedThemeMode = localStorage.getItem('themeMode');
        if(savedThemeMode === 'light') document.body.classList.add('light-mode');
        const savedColor = localStorage.getItem('themeColor');
        if(savedColor) setTheme(savedColor, true);

        db.ref('/').on('value', snap => {
            const val = snap.val() || {};
            const m = Object.keys(val.movies || {}).map(k => ({id:k, ...val.movies[k], type:'movie'}));
            const s = Object.keys(val.webseries || {}).map(k => ({id:k, ...val.webseries[k], type:'series'}));
            allData = [...m, ...s].sort((a,b) => b.timestamp - a.timestamp);
            
            renderHome(); renderMovies(); renderSeries(); renderAnime(); renderProfileLists();
            renderLive(Object.keys(val.live_tv || {}).map(k => ({id:k, ...val.live_tv[k]})));
            
            renderGenreChips('movie-genres', movieGenres, 'movie');
            renderGenreChips('series-genres', seriesGenres, 'series');
        });
    }

    function goToGenreMovies(genre) {
        selectedMovieGenre = genre;
        tab('movies-page');
        let data = allData.filter(i => i.type === 'movie' || i.type === 'series');
        if(hideAdult) data = data.filter(i => i.category !== '18+');
        const container = document.getElementById('movie-dynamic-sections');
        const grid = document.getElementById('grid-movies');
        container.style.display = 'none';
        grid.style.display = 'grid';
        const filteredData = data.filter(i => (i.genre && i.genre.includes(genre)) || (i.category && i.category.includes(genre)));
        grid.innerHTML = filteredData.length > 0 ? filteredData.map(i => card(i)).join('') : '<p style="grid-column: span 3; padding:20px; text-align:center; opacity:0.5;">No content found.</p>';
        renderGenreChips('movie-genres', movieGenres, 'movie');
    }

    function showToast(msg) {
        const t = document.getElementById('toast-box');
        t.innerText = msg; t.style.display = 'block';
        setTimeout(() => { t.style.display = 'none'; }, 2500);
    }

    function renderGenreChips(containerId, list, type) {
        const container = document.getElementById(containerId);
        let updatedList = [...list];
        if(type === 'movie' && !hideAdult && !updatedList.includes("18+")) updatedList.push("18+");
        if(type === 'series' && !hideAdult) {
            if(!updatedList.includes("Mature")) updatedList.push("Mature");
            if(!updatedList.includes("18+ Animated")) updatedList.push("18+ Animated");
        }
        const selected = (type === 'movie') ? selectedMovieGenre : selectedSeriesGenre;
        container.innerHTML = updatedList.map(g => `<div class="genre-chip ${selected === g ? 'active' : ''}" onclick="filterByGenre('${type}', '${g}')">${g}</div>`).join('');
    }

    function filterByGenre(type, genre) {
        if(type === 'movie') { selectedMovieGenre = genre; renderMovies(); renderGenreChips('movie-genres', movieGenres, 'movie'); }
        else { selectedSeriesGenre = genre; renderSeries(); renderGenreChips('series-genres', seriesGenres, 'series'); }
    }

    // Player functions
    function playerPointerDown(e) { if(e.target.closest('.p-btn, .p-progress-box, .p-menu, #p-ep-drawer')) return; isGestureActive = true; const x = (e.clientX || (e.touches && e.touches[0].clientX)); gestureStartY = (e.clientY || (e.touches && e.touches[0].clientY)); gestureSide = x < (window.innerWidth / 2) ? "left" : "right"; initialVol = video.volume; initialBright = currentBrightness; speedTimer = setTimeout(() => { if(isGestureActive) { video.playbackRate = 2.0; document.getElementById('speed-overlay').style.display = 'block'; playerUI.classList.add('hidden'); } }, 500); }
    function playerPointerMove(e) { if(!isGestureActive) return; const currentY = (e.clientY || (e.touches && e.touches[0].clientY)); const diff = gestureStartY - currentY; const sensitivity = 150; if(Math.abs(diff) > 10) { clearTimeout(speedTimer); if(gestureSide === "left") { let change = (diff / sensitivity) * 100; currentBrightness = Math.max(0, Math.min(100, initialBright + change)); updateBrightnessUI(currentBrightness); } else { let change = (diff / sensitivity); let newVol = Math.max(0, Math.min(1, initialVol + change)); setVolume(newVol); updateVolumeUI(newVol); } } }
    function playerPointerUp() { isGestureActive = false; clearTimeout(speedTimer); video.playbackRate = currentManualSpeed; document.getElementById('speed-overlay').style.display = 'none'; clearTimeout(gestureHideTimer); gestureHideTimer = setTimeout(() => { document.getElementById('g-bright-wrap').style.display = 'none'; document.getElementById('g-vol-wrap').style.display = 'none'; }, 800); }
    function updateBrightnessUI(val) { document.getElementById('g-bright-wrap').style.display = 'flex'; document.getElementById('g-bright-fill').style.height = val + '%'; document.getElementById('g-bright-text').innerText = Math.round(val) + '%'; document.getElementById('brightness-overlay').style.opacity = (100 - val) / 120; }
    function updateVolumeUI(val) { document.getElementById('g-vol-wrap').style.display = 'flex'; document.getElementById('g-vol-fill').style.height = (val * 100) + '%'; document.getElementById('g-vol-text').innerText = Math.round(val * 100) + '%'; }
    function setTheme(color, isInitial = false) { document.documentElement.style.setProperty('--primary', color); localStorage.setItem('themeColor', color); document.querySelectorAll('.theme-card').forEach(card => { if(card.getAttribute('onclick').includes(color)) card.classList.add('active'); else card.classList.remove('active'); }); }
    function toggleThemeMode() { document.body.classList.toggle('light-mode'); localStorage.setItem('themeMode', document.body.classList.contains('light-mode') ? 'light' : 'dark'); }
    function cycleAnimBorder() { currentAnimMode = (currentAnimMode + 1) % animNames.length; localStorage.setItem('animMode', currentAnimMode); applyAnimMode(currentAnimMode); }
    function applyAnimMode(mode) { document.body.classList.remove('anim-1', 'anim-2', 'anim-3', 'anim-active'); if (mode > 0) document.body.classList.add(`anim-${mode}`, 'anim-active'); document.getElementById('anim-status').innerText = animNames[mode]; }
    function toggleAdultMode() { hideAdult = !hideAdult; localStorage.setItem('hideAdult', hideAdult); applyAdultMode(); renderHome(); renderMovies(); renderSeries(); renderAnime(); renderProfileLists(); }
    function applyAdultMode() { if(document.getElementById('adult-status')) document.getElementById('adult-status').innerText = hideAdult ? "OFF" : "ON"; if(document.getElementById('adult-section')) document.getElementById('adult-section').style.display = hideAdult ? 'none' : 'block'; }
    function clearHistory() { document.getElementById('confirm-modal').style.display = 'flex'; }
    function closeConfirmModal() { document.getElementById('confirm-modal').style.display = 'none'; }
    function executeClearHistory() { localStorage.removeItem('history'); renderProfileLists(); closeConfirmModal(); showToast("History Cleared!"); }
    function toggleSpeedMenu(e) { if (e) e.stopPropagation(); const menu = document.getElementById('p-speed-menu'); menu.style.display = (menu.style.display === 'flex' ? 'none' : 'flex'); if(menu.style.display === 'flex') clearTimeout(uiTimer); }
    function changeSpeed(rate) { currentManualSpeed = rate; video.playbackRate = rate; document.getElementById('speed-label').innerText = rate + 'x'; document.getElementById('p-speed-menu').style.display = 'none'; document.querySelectorAll('.speed-item').forEach(item => { item.classList.toggle('active', item.innerText === rate + 'x'); }); }
    function playVideo(url, title, contentId) { if(contentId) addToHistory(contentId); document.getElementById('player-overlay').style.display = 'block'; bottomNav.style.display = 'none'; currentItem = allData.find(x => x.id === contentId); document.getElementById('video-title').innerText = (currentItem ? currentItem.category : "Video") + " | " + title; if(currentItem && currentItem.type === 'series' && currentItem.episodes) { document.getElementById('drawer-arrow-btn').style.display = 'flex'; renderEpisodeDrawer(); } else { document.getElementById('drawer-arrow-btn').style.display = 'none'; } document.getElementById('p-ep-drawer').classList.remove('open'); document.getElementById('quality-label').innerText = 'Auto'; if(hls) hls.destroy(); if(url.includes('.m3u8')) { if(Hls.isSupported()) { hls = new Hls({ capLevelToPlayerSize: true, autoStartLoad: true }); hls.loadSource(url); hls.attachMedia(video); hls.on(Hls.Events.MANIFEST_PARSED, () => { setupQuality(); setupAudio(); setupSubtitles(); checkResume(contentId); video.play(); }); hls.on(Hls.Events.AUDIO_TRACKS_UPDATED, setupAudio); hls.on(Hls.Events.SUBTITLE_TRACKS_UPDATED, setupSubtitles); } } else { video.src = url; video.onloadedmetadata = () => { checkResume(contentId); video.play(); }; } showUI(); }
    function checkResume(id) { if(!id) return; const savedTime = localStorage.getItem('resume_' + id); if (savedTime && parseFloat(savedTime) > 10) { pendingResumeTime = parseFloat(savedTime); document.getElementById('resume-msg').innerText = "Continue watching from " + fmt(pendingResumeTime) + "?"; document.getElementById('resume-modal').style.display = 'flex'; } }
    function resumeVideo() { video.currentTime = pendingResumeTime; document.getElementById('resume-modal').style.display = 'none'; video.play(); }
    function restartVideo() { video.currentTime = 0; document.getElementById('resume-modal').style.display = 'none'; video.play(); }
    function toggleEpDrawer(e) { if(e) e.stopPropagation(); document.getElementById('p-ep-drawer').classList.toggle('open'); if(document.getElementById('p-ep-drawer').classList.contains('open')) clearTimeout(uiTimer); }
    function renderEpisodeDrawer() { if(!currentItem || !currentItem.episodes) return; document.getElementById('drawer-ep-list').innerHTML = currentItem.episodes.map((ep, i) => `<div class="drawer-item" onclick="playVideo('${ep.link}', '${currentItem.title} - E${i+1}', '${currentItem.id}')"><i class="fas fa-play-circle"></i><span>Episode ${i+1}</span></div>`).join(''); }
    function setupQuality() { if(!hls || hls.levels.length === 0) return; let html = '<div class="p-menu-header">Quality</div>'; html += `<div class="p-menu-item" onclick="changeQ(-1, 'Auto')">Auto</div>`; hls.levels.forEach((lvl, i) => { let label = lvl.height + "p"; html += `<div class="p-menu-item" onclick="changeQ(${i}, '${label}')">${label}</div>`; }); document.getElementById('p-quality-menu').innerHTML = html; }
    window.changeQ = (i, label) => { if(hls) { hls.currentLevel = i; hls.loadLevel = i; document.getElementById('quality-label').innerText = label; document.getElementById('p-quality-menu').style.display = 'none'; } };
    function setupAudio() { if(!hls) return; let html = '<div class="p-menu-header">Audio Track</div>'; if(hls.audioTracks.length <= 1) html += '<div class="p-menu-item active">Default</div>'; else hls.audioTracks.forEach((track, i) => { html += `<div class="p-menu-item" onclick="changeAudio(${i})">${track.name || track.lang || `Track ${i+1}`}</div>`; }); document.getElementById('p-audio-menu').innerHTML = html; }
    window.changeAudio = (i) => { if(hls) { hls.audioTrack = i; document.getElementById('p-audio-menu').style.display = 'none'; } };
    function setupSubtitles() { if(!hls) return; let html = '<div class="p-menu-header">Subtitles</div>'; html += `<div class="p-menu-item" onclick="changeSub(-1)">Off</div>`; if(hls.subtitleTracks.length > 0) hls.subtitleTracks.forEach((track, i) => { html += `<div class="p-menu-item" onclick="changeSub(${i})">${track.name || track.lang || `Subtitle ${i+1}`}</div>`; }); document.getElementById('p-subtitle-menu').innerHTML = html; }
    window.changeSub = (i) => { if(hls) { hls.subtitleTrack = i; hls.subtitleDisplay = (i !== -1); document.getElementById('p-subtitle-menu').style.display = 'none'; } };
    function setVolume(v) { video.volume = v; video.muted = (v == 0); updateVolIcon(); }
    function muteToggle() { video.muted = !video.muted; updateVolIcon(); }
    function updateVolIcon() { let icon = video.muted || video.volume == 0 ? 'fas fa-volume-xmark' : (video.volume < 0.5 ? 'fas fa-volume-low' : 'fas fa-volume-high'); document.getElementById('vol-icon').className = icon; }
    function toggleMenu(e, id) { if (e) e.stopPropagation(); const menu = document.getElementById(id); const isOpen = menu.style.display === 'flex'; document.querySelectorAll('.p-menu').forEach(m => m.style.display = 'none'); if(!isOpen) { menu.style.display = 'flex'; clearTimeout(uiTimer); } }
    function togglePlay() { video.paused ? (video.play(), updateIcons('fas fa-pause')) : (video.pause(), updateIcons('fas fa-play')); }
    function updateIcons(cls) { document.getElementById('small-play-btn').className = cls; }
    video.ontimeupdate = () => { if(!dragging && video.duration) { const p = (video.currentTime / video.duration) * 100; document.getElementById('p-fill').style.width = p + '%'; document.getElementById('p-current').innerText = fmt(video.currentTime); document.getElementById('p-duration').innerText = fmt(video.duration); if(currentItem && currentItem.id) { if (video.duration - video.currentTime < 15) localStorage.removeItem('resume_' + currentItem.id); else if (video.currentTime > 5) localStorage.setItem('resume_' + currentItem.id, video.currentTime); } } };
    function fmt(s) { let m = Math.floor(s/60); s = Math.floor(s%60); return (m<10?'0'+m:m)+":"+(s<10?'0'+s:s); }
    function startDrag(e) { dragging = true; doDrag(e); window.addEventListener('mousemove', doDrag); window.addEventListener('mouseup', stopDrag); window.addEventListener('touchmove', doDrag); window.addEventListener('touchend', stopDrag); }
    function doDrag(e) { const rect = document.querySelector('.p-bar-bg').getBoundingClientRect(); const x = (e.clientX || (e.touches && e.touches[0].clientX)); let pos = (x - rect.left) / rect.width; pos = Math.max(0, Math.min(1, pos)); document.getElementById('p-fill').style.width = (pos*100)+'%'; if(video.duration) video.currentTime = pos * video.duration; }
    function stopDrag() { dragging = false; window.removeEventListener('mousemove', doDrag); window.removeEventListener('mouseup', stopDrag); window.removeEventListener('touchmove', doDrag); window.removeEventListener('touchend', stopDrag); }
    async function handleFullscreen() { const wrap = document.getElementById('v-wrapper'); if(!document.fullscreenElement) { if(wrap.requestFullscreen) await wrap.requestFullscreen(); else if(wrap.webkitRequestFullscreen) await wrap.webkitRequestFullscreen(); if(screen.orientation && screen.orientation.lock) screen.orientation.lock('landscape').catch(()=>{}); showUI(); } else { if(document.exitFullscreen) document.exitFullscreen(); else if(document.webkitExitFullscreen) document.webkitExitFullscreen(); } }
    let fit = 0; function cycleFit() { const ms = ['contain','cover','fill']; fit = (fit+1)%3; video.style.objectFit = ms[fit]; }
    function showUI() { playerUI.classList.remove('hidden'); clearTimeout(uiTimer); uiTimer = setTimeout(()=> { if(Array.from(document.querySelectorAll('.p-menu')).some(m => m.style.display === 'flex')) return; playerUI.classList.add('hidden'); }, 3500); }
    function togglePlayerUI() { if(document.getElementById('p-ep-drawer').classList.contains('open')) { document.getElementById('p-ep-drawer').classList.remove('open'); return; } if(playerUI.classList.contains('hidden')) showUI(); else playerUI.classList.add('hidden'); }
    function closePlayer() { video.pause(); document.getElementById('player-overlay').style.display='none'; bottomNav.style.display = 'flex'; if(document.fullscreenElement) document.exitFullscreen(); }
    function addToHistory(id) { let history = JSON.parse(localStorage.getItem('history') || '[]'); history = history.filter(x => x !== id); history.unshift(id); if(history.length > 20) history.pop(); localStorage.setItem('history', JSON.stringify(history)); }
    function toggleSaveEpisode(seriesId, epIdx) { let epId = seriesId + "_ep_" + epIdx; let saved = JSON.parse(localStorage.getItem('saved') || '[]'); if(saved.includes(epId)) { saved = saved.filter(x => x !== epId); showToast("Removed from Watchlist"); } else { saved.push(epId); showToast("Added to Watchlist"); } localStorage.setItem('saved', JSON.stringify(saved)); showDetail(seriesId); renderProfileLists(); }
    function toggleSave(id) { let saved = JSON.parse(localStorage.getItem('saved') || '[]'); if(saved.includes(id)) { saved = saved.filter(x => x !== id); showToast("Removed from Watchlist"); } else { saved.push(id); showToast("Added to Watchlist"); } localStorage.setItem('saved', JSON.stringify(saved)); showDetail(id); renderProfileLists(); }
    async function shareContent(title) { const shareData = { title: 'Anime07x', text: `Watch ${title} on Anime07x!`, url: 'https://t.me/anime07xx' }; try { await navigator.share(shareData); } catch (err) { } }

    function renderProfileLists() { 
        let hIds = JSON.parse(localStorage.getItem('history') || '[]'); let sIds = JSON.parse(localStorage.getItem('saved') || '[]'); 
        fill('history-list', hIds.map(id => allData.find(x => x.id === id)).filter(x => x)); 
        let savedItems = []; sIds.forEach(id => { if(id.includes('_ep_')) { let [seriesId, , epIdx] = id.split('_'); let parent = allData.find(x => x.id === seriesId); if(parent) savedItems.push({ ...parent, id: seriesId, title: parent.title + " - E" + (parseInt(epIdx)+1) }); } else { let item = allData.find(x => x.id === id); if(item) savedItems.push(item); } }); fill('saved-list', savedItems); 
    }
    
    function renderHome() { 
        const homeData = hideAdult ? allData.filter(i => i.category !== '18+') : allData;
        const slideItems = homeData.slice(0,5);
        document.getElementById('main-slider').innerHTML = slideItems.map(i => `<div class="slide" onclick="showDetail('${i.id}')"><img src="${i.backdrop}"></div>`).join(''); 
        if(autoSlideInterval) clearInterval(autoSlideInterval); currentSlideIndex = 0; document.getElementById('main-slider').style.transform = `translateX(0%)`;
        if(slideItems.length > 1) { autoSlideInterval = setInterval(() => { currentSlideIndex = (currentSlideIndex + 1) % slideItems.length; document.getElementById('main-slider').style.transform = `translateX(-${currentSlideIndex * 100}%)`; }, 3500); }
        fill('hollywood-home', homeData.filter(i => i.category === 'Hollywood')); fill('bollywood-home', homeData.filter(i => i.category === 'Bollywood')); fill('web-series-home', homeData.filter(i => i.type === 'series').slice(0,10)); fill('south-indian-home', homeData.filter(i => i.category === 'South Indian')); fill('korean-home', homeData.filter(i => i.category === 'Korean' || i.category === 'KDrama' || i.category === 'K-Drama')); fill('cartoon-home', homeData.filter(i => i.category === 'Cartoon')); if(!hideAdult) { fill('18-plus-home', allData.filter(i => i.category === '18+')); document.getElementById('adult-section').style.display = 'block'; } else if(document.getElementById('adult-section')) document.getElementById('adult-section').style.display = 'none';
    }

    function renderMovies() { 
        let data = allData.filter(i => i.type === 'movie'); 
        if(hideAdult) data = data.filter(i => i.category !== '18+'); 
        const container = document.getElementById('movie-dynamic-sections');
        const grid = document.getElementById('grid-movies');
        if(selectedMovieGenre === "All") {
            grid.style.display = 'none'; container.style.display = 'block';
            const categoriesToShow = ["Hollywood", "Bollywood", "South Indian", "Korean", "Anime", "Cartoon"];
            if(!hideAdult) categoriesToShow.push("18+");
            let html = "";
            categoriesToShow.forEach(cat => {
                const filtered = data.filter(i => i.category === cat);
                if(filtered.length > 0) {
                    html += `<div class="category-section"><div class="category-header"><h2 class="category-title">${cat}</h2><span class="view-all" onclick="filterByGenre('movie', '${cat}')">VIEW ALL</span></div><div class="content-slider">${filtered.map(i => card(i)).join('')}</div></div>`;
                }
            });
            container.innerHTML = html;
        } else {
            container.style.display = 'none'; grid.style.display = 'grid';
            const filteredData = data.filter(i => (i.category === selectedMovieGenre) || (i.genre && i.genre.includes(selectedMovieGenre)));
            grid.innerHTML = filteredData.length > 0 ? filteredData.map(i => card(i)).join('') : '<p style="grid-column: span 3; padding:20px; text-align:center; opacity:0.5;">No content found.</p>';
        }
    }

    function renderSeries() { 
        let data = allData.filter(i => i.type === 'series'); 
        if(hideAdult) data = data.filter(i => i.category !== '18+' && i.category !== 'Mature' && i.category !== '18+ Animated'); 

        const container = document.getElementById('series-dynamic-sections');
        const grid = document.getElementById('grid-series-filtered');

        if(selectedSeriesGenre === "All") {
            grid.style.display = 'none'; container.style.display = 'block';
            // Custom Priority Order: Anime first, then others
            const cats = ["Anime", "Action", "Adventure", "Drama", "Romance", "Thriller", "Horror", "Sci-Fi", "Fantasy", "Comedy", "Documentary", "K-Drama", "C-Drama", "J-Drama", "18+ Animated", "Mature"];
            
            let html = "";
            cats.forEach(cat => {
                if(hideAdult && (cat === 'Mature' || cat === '18+ Animated')) return;
                // Matching by Category OR Genre (for more results)
                const filtered = data.filter(i => i.category === cat || (i.genre && i.genre.includes(cat)));
                if(filtered.length > 0) {
                    html += `<div class="category-section">
                                <div class="category-header">
                                    <h2 class="category-title">${cat} Web Series</h2>
                                    <span class="view-all" onclick="filterByGenre('series', '${cat}')">VIEW ALL</span>
                                </div>
                                <div class="content-slider">${filtered.map(i => card(i)).join('')}</div>
                             </div>`;
                }
            });
            container.innerHTML = html || '<p style="padding:20px; text-align:center; opacity:0.5;">No series found.</p>';
        } else {
            container.style.display = 'none'; grid.style.display = 'grid';
            const filteredData = data.filter(i => (i.category === selectedSeriesGenre) || (i.genre && i.genre.includes(selectedSeriesGenre)));
            grid.innerHTML = filteredData.length > 0 ? filteredData.map(i => card(i)).join('') : '<p style="grid-column: span 3; padding:20px; text-align:center; opacity:0.5;">No content found.</p>';
        }
    }
    
    function renderAnime() { 
        const data = hideAdult ? allData.filter(i => i.category !== '18+') : allData; 
        fill('anime-movies-list', data.filter(i => i.category === 'Anime' && i.type === 'movie')); 
        fill('anime-series-list', data.filter(i => i.category === 'Anime' && i.type === 'series'));
        fill('cartoon-movies-list', data.filter(i => i.category === 'Cartoon' && i.type === 'movie'));
        fill('cartoon-series-list', data.filter(i => i.category === 'Cartoon' && i.type === 'series'));
    }

    function renderLive(live) { document.getElementById('grid-live').innerHTML = live.map(i => `<div onclick="playVideo('${i.link}', '${i.name}')" style="background:var(--card); padding:10px; border-radius:10px; text-align:center;"><img src="${i.logo}" style="width:100%; height:50px; object-fit:contain;"><p style="font-size:10px;">${i.name}</p></div>`).join(''); }
    function fill(id, list) { document.getElementById(id).innerHTML = list.length > 0 ? list.map(i => card(i)).join('') : '<p style="padding:15px; opacity:0.5; font-size:12px;">Nothing here</p>'; }
    function card(i) { const isNew = (Date.now() - (i.timestamp || 0)) < 86400000; const badge = isNew ? `<div class="new-badge">NEW</div>` : ""; return `<div class="content-card" onclick="showDetail('${i.id}')">${badge}<img src="${i.poster}"><div class="card-title">${i.title}</div></div>`; }
    function tab(id) { document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); document.getElementById(id).classList.add('active'); document.querySelectorAll('.nav-item').forEach(n=>n.classList.toggle('active', n.getAttribute('onclick').includes(id))); if(id === 'account-page') renderProfileLists(); }
    
    function showDetail(id) { 
        const item = allData.find(i => i.id === id); if(!item) return; 
        let savedIds = JSON.parse(localStorage.getItem('saved') || '[]'); 
        let related = allData.filter(r => r.category === item.category && r.id !== item.id).slice(0,10);
        let eps = (item.episodes || []).map((e, idx) => { let epId = item.id + "_ep_" + idx; let isEpSaved = savedIds.includes(epId); return ` <div class="ep-list-item"> <span onclick="playVideo('${e.link}', '${item.title} - E${idx+1}', '${item.id}')" style="flex:1;">Episode ${idx+1}</span> <div style="display:flex; gap:20px; align-items:center;"> <i class="fas ${isEpSaved ? 'fa-check' : 'fa-plus'}" onclick="toggleSaveEpisode('${item.id}', ${idx})" style="color:${isEpSaved ? 'var(--primary)' : '#fff'}; cursor:pointer;"></i> <i class="fas fa-play-circle" onclick="playVideo('${e.link}', '${item.title} - E${idx+1}', '${item.id}')" style="color:var(--primary); font-size:20px;"></i> </div> </div>`; }).join(''); 
        document.getElementById('detail-page').innerHTML = ` <div class="detail-backdrop"> <button onclick="tab('home-page')" style="position:absolute; top:20px; left:20px; z-index:10; background:rgba(0,0,0,0.5); width:40px; height:40px; border-radius:50%; border:none; color:#fff;"><i class="fas fa-arrow-left"></i></button> <img src="${item.backdrop}"> <div class="backdrop-overlay"></div> </div> <div class="detail-content"> <div class="detail-main"> <img class="detail-poster-img" src="${item.poster}"> <div class="detail-info"><h2>${item.title}</h2><div class="meta-badges"><span class="badge">2025</span><span class="badge"><i class="fas fa-star"></i> 8.5</span><span class="badge">${item.category || 'undefined'}</span></div></div> </div> <div class="detail-actions"> <button class="btn-episodes" onclick="document.getElementById('ep-section').scrollIntoView({behavior:'smooth'})"><i class="fas fa-play"></i> PLAY</button> <button class="btn-plus" onclick="toggleSave('${item.id}')"><i class="fas ${savedIds.includes(id) ? 'fa-check' : 'fa-plus'}"></i></button> <button class="btn-share" onclick="shareContent('${item.title}')"><i class="fas fa-share-nodes"></i></button> </div> <div class="desc-box">Anime07x<br>OWNER BY RIDHAM BOHARA</div> <div class="section-header"><div class="section-bar"></div><h3>Play List</h3></div> <div id="ep-section"> ${item.type === 'movie' ? `<div class="ep-list-item" onclick="playVideo('${item.link}', '${item.title}', '${item.id}')"><span>Watch Movie</span><i class="fas fa-play-circle" style="color:var(--primary)"></i></div>` : eps} </div> <div class="section-header"><div class="section-bar"></div><h3>More Like This</h3></div> <div class="content-slider" style="padding:10px 0 50px 0;">${related.map(r => card(r)).join('')}</div> </div>`; 
        tab('detail-page'); document.getElementById('detail-page').scrollTop = 0;
    }
    
    function handleSearch(q) { if(!q) { renderMovies(); return; } const data = hideAdult ? allData.filter(i => i.category !== '18+') : allData; document.getElementById('grid-movies').innerHTML = data.filter(i => i.title.toLowerCase().includes(q.toLowerCase())).map(i => card(i)).join(''); tab('movies-page'); document.getElementById('movie-dynamic-sections').style.display='none'; document.getElementById('grid-movies').style.display='grid'; }
    function openThemeModal() { document.getElementById('appearance-modal').style.display='flex'; }
    function closeThemeModal() { document.getElementById('appearance-modal').style.display='none'; }

    init();
</script>
</body>
</html>